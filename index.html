<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Generator</title>
    <style>
        #meme_text {
            background-color: transparent;
            font-size: 40px;
            font-family: "Impact";
            color: white;
            text-shadow: black 0px 0px 10px;
            text-align: center;
            width: 600px;
            position: absolute;
            left: 0;
            top: 400px;
        }

        #image {
            width: 600px;
            border: 3px solid #000000;
        }

        canvas {
            display: none;
        }
    </style>
</head>
<body>

    <form>
        Select a picture: <input type="file" id="user_picture" onchange="update_image()">
        <p>
        Meme text: <input type="text" id="user_text" oninput="update_text()" maxlength="70">
        <p>
    </form>

    <div id="meme_container" style="position: relative;">
        <div id="meme_text">&nbsp;</div>
        <img id="image" src="" alt="Meme Image">
    </div>
    
    <canvas id="canvas" width="600" height="500"></canvas>
    
    <button onclick="download_meme()">Download Meme</button>

    <script>
        // Update image onto the screen
        function update_image() {
            var img = document.querySelector('#image'); // Access the image element
            var file = document.querySelector('input[type=file]').files[0]; // Access the selected file
            img.src = window.URL.createObjectURL(file); // Set the image source to the selected file
        }

        // Write the text onto the meme
        function update_text() {
            var user_text = document.getElementById("user_text").value; // Get the text from the input field
            var meme_text = document.getElementById("meme_text"); // Get the meme text element
            meme_text.innerHTML = user_text; // Set the meme text to the input value
        }

        // Combine image and text onto a canvas and download
        function download_meme() {
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            var img = document.getElementById("image");
            var text = document.getElementById("user_text").value;
            
            // Draw the image on the canvas
            context.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas before redrawing
            context.drawImage(img, 0, 0, canvas.width, canvas.height);
            
            // Add the text on top of the image
            context.font = "40px Impact";
            context.fillStyle = "white";
            context.textAlign = "center";
            context.textBaseline = "bottom";
            context.fillText(text, canvas.width / 2, canvas.height - 50);
            context.lineWidth = 3;
            context.strokeStyle = "black";
            context.strokeText(text, canvas.width / 2, canvas.height - 50);
            
            // Convert the canvas to an image and download
            var link = document.createElement("a");
            link.href = canvas.toDataURL("image/png");
            link.download = "meme.png";
            link.click();
        }
    </script>

</body>
</html>
